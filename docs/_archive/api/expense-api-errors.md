# 経費申請API エラーレスポンス仕様

## エラーレスポンス形式

すべてのエラーレスポンスは以下の形式で返されます：

```json
{
  "error": {
    "code": "エラーコード",
    "message": "エラーメッセージ"
  }
}
```

## 経費申請関連のエラーコード

### 月次・年次上限エラー

#### 月次上限超過エラー
- **エラーコード**: `E003B001`
- **HTTPステータス**: `400 Bad Request`
- **メッセージ例**: `月次上限を超過します（残り: 6401円）`

**レスポンス例**:
```json
{
  "error": {
    "code": "E003B001",
    "message": "月次上限を超過します（残り: 6401円）"
  }
}
```

#### 年次上限超過エラー
- **エラーコード**: `E003B002`
- **HTTPステータス**: `400 Bad Request`
- **メッセージ例**: `年次上限を超過します（残り: 50000円）`

**レスポンス例**:
```json
{
  "error": {
    "code": "E003B002",
    "message": "年次上限を超過します（残り: 50000円）"
  }
}
```

## 影響を受けるエンドポイント

以下のエンドポイントで月次・年次上限エラーが発生する可能性があります：

### 1. 経費申請提出
- **エンドポイント**: `POST /api/v1/expenses/{id}/submit`
- **説明**: 経費申請を提出する際に、月次・年次上限をチェック

### 2. 領収書付き経費申請作成
- **エンドポイント**: `POST /api/v1/expenses/with-receipts`
- **説明**: 新規経費申請作成時に上限をチェック

### 3. 領収書付き経費申請更新
- **エンドポイント**: `PUT /api/v1/expenses/{id}/with-receipts`
- **説明**: 経費申請更新時に上限をチェック

### 4. 領収書一覧取得
- **エンドポイント**: `GET /api/v1/expenses/{id}/receipts`
- **説明**: 領収書取得時の権限チェックで上限エラーが発生する可能性

### 5. 領収書削除
- **エンドポイント**: `DELETE /api/v1/expenses/{id}/receipts/{receiptId}`
- **説明**: 領収書削除時の権限チェックで上限エラーが発生する可能性

### 6. 領収書表示順序更新
- **エンドポイント**: `PUT /api/v1/expenses/{id}/receipts/order`
- **説明**: 表示順序更新時の権限チェックで上限エラーが発生する可能性

## その他の経費申請エラーコード

### バリデーションエラー
- `E001V001`: 件名は必須です
- `E001V002`: 金額は1円以上1000万円以下で入力してください
- `E001V003`: 使用日は必須です
- `E001V004`: 使用理由は10文字以上1000文字以内で入力してください
- `E001V005`: 領収書URLは必須です

### ビジネスロジックエラー
- `E001B001`: 既に提出済みの申請は編集できません
- `E001B002`: 承認済みの申請は取り消しできません
- `E001B003`: 申請期限を過ぎた経費は申請できません

### NotFoundエラー
- `E001N001`: 指定された経費申請が見つかりません

### システムエラー
- `E001S001`: 経費申請の保存に失敗しました
- `E001S002`: 無効なステータスです

### 承認者設定エラー
- `E001C001`: 承認者が設定されていません

## HTTPステータスコード対応表

| ステータスコード | 説明 | 使用場面 |
|--------------|------|---------|
| 400 Bad Request | リクエストが不正 | バリデーションエラー、上限超過エラー |
| 401 Unauthorized | 認証が必要 | ログインしていない |
| 403 Forbidden | アクセス権限なし | 他人の経費申請へのアクセス |
| 404 Not Found | リソースが見つからない | 存在しない経費申請ID |
| 500 Internal Server Error | サーバーエラー | システム障害 |

## 更新履歴

- 2025-01-20: 月次・年次上限エラーのHTTPステータスコードを500から400に修正