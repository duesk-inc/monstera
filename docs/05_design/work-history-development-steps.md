# 職務経歴機能 開発ステップ詳細ToDoリスト

## 📋 開発フェーズ構成

### Phase 1: 環境・インフラ準備
### Phase 2: データベース設計・実装
### Phase 3: バックエンドAPI実装
### Phase 4: フロントエンド実装
### Phase 5: PDF生成機能
### Phase 6: テスト・品質保証
### Phase 7: 名称変更・移行作業

---

## Phase 1: 環境・インフラ準備 (1-2日)

### 1.1 技術選定・環境確認
- [ ] **1.1.1** Chrome headlessのインストール確認
  - 本番・開発環境でのChrome headless実行可能性確認
  - 日本語フォント対応確認
  - テスト実行: PDF生成動作確認

- [ ] **1.1.2** 必要パッケージの追加
  - Go依存関係: `golang-migrate`, UUID生成ライブラリ確認
  - フロントエンド: react-window, date-fns追加確認
  - HTMLテンプレート用ディレクトリ作成: `templates/`

- [ ] **1.1.3** 開発環境のDocker設定更新
  - Chrome headless用のDockerfile更新
  - 必要フォントのインストール設定
  - ボリューム設定でテンプレートディレクトリをマウント

### 1.2 ディレクトリ構造準備
- [ ] **1.2.1** バックエンドディレクトリ作成
  - `pkg/calculator/` (経験年数計算)
  - `pkg/normalizer/` (技術名正規化)
  - `internal/service/work_history_pdf_service.go`
  - `templates/work_history.html`

- [ ] **1.2.2** フロントエンドディレクトリ作成
  - `src/app/(authenticated)/(engineer)/work-history/`
  - `src/components/features/workHistory/`
  - `src/hooks/workHistory/`
  - `src/types/workHistory.ts`
  - `src/lib/api/workHistory.ts`

---

## Phase 2: データベース設計・実装 (2-3日)

### 2.1 新規テーブル作成
- [ ] **2.1.1** technology_masterテーブル作成
  - マイグレーションファイル作成: `000XXX_create_technology_master.up.sql`
  - 実行・ロールバックテスト
  - 単体テスト: テーブル作成確認

- [ ] **2.1.2** 初期技術データ投入
  - プログラミング言語100件のシードデータ作成
  - サーバー・DB50件のシードデータ作成
  - ツール100件のシードデータ作成
  - マイグレーションファイル: `000XXX_seed_technology_master.up.sql`

### 2.2 既存テーブル拡張
- [ ] **2.2.1** work_historiesテーブル拡張
  - duration_monthsカラム追加（計算カラム）
  - インデックス追加: start_date, duration_months
  - マイグレーションファイル作成・テスト

### 2.3 ビュー作成
- [ ] **2.3.1** user_skill_summaryビュー作成
  - SQLクエリ作成・性能テスト
  - マイグレーションファイル作成
  - 実データでの動作確認

- [ ] **2.3.2** user_it_experienceビュー作成
  - SQLクエリ作成・性能テスト
  - マイグレーションファイル作成
  - 複数ユーザーでの計算結果確認

### 2.4 データベーステスト
- [ ] **2.4.1** パフォーマンステスト
  - 100件の職務経歴データ作成
  - ビューのクエリ実行時間測定（<100ms目標）
  - インデックス効果の確認

---

## Phase 3: バックエンドAPI実装 (5-7日)

### 3.1 共通ユーティリティ実装
- [ ] **3.1.1** 経験年数計算ロジック実装
  - `pkg/calculator/experience_calculator.go`作成
  - CalculateITExperience関数実装
  - CalculateSkillExperience関数実装
  - 単体テスト作成・実行

- [ ] **3.1.2** 技術名正規化ロジック実装
  - `pkg/normalizer/technology_normalizer.go`作成
  - Normalize関数実装（表記ゆれ対応）
  - 単体テスト作成（100パターン以上）

- [ ] **3.1.3** バリデーション実装
  - `internal/validator/work_history_validator.go`作成
  - 全入力項目のバリデーションルール実装
  - エラーメッセージの日本語化

### 3.2 モデル・DTO実装
- [ ] **3.2.1** レスポンスDTO拡張
  - IT経験年数、技術スキル経験年数フィールド追加
  - プロジェクト数フィールド追加
  - JSON構造体タグの確認

- [ ] **3.2.2** リクエストDTO実装
  - 職務経歴更新リクエスト
  - 一時保存リクエスト
  - PDF生成リクエスト（参画開始可能日付き）

### 3.3 リポジトリ層実装
- [ ] **3.3.1** 技術マスタリポジトリ実装
  - TechnologyMasterRepository作成
  - 候補検索機能実装
  - 使用回数更新機能実装

- [ ] **3.3.2** 職務経歴リポジトリ拡張
  - 計算ロジック呼び出し機能追加
  - ビューからのデータ取得機能実装
  - トランザクション管理の確認

### 3.4 サービス層実装
- [ ] **3.4.1** WorkHistoryService拡張
  - IT経験年数計算機能統合
  - 技術スキル経験年数計算機能統合
  - レスポンスデータ生成ロジック実装

- [ ] **3.4.2** 技術候補サービス実装
  - TechnologySuggestionService作成
  - 前方一致検索実装
  - 使用頻度順ソート実装

### 3.5 ハンドラー層実装
- [ ] **3.5.1** WorkHistoryHandler作成
  - `/api/v1/work-history` GET実装
  - `/api/v1/work-history` PUT実装
  - `/api/v1/work-history/temp-save` POST実装
  - エラーハンドリング実装

- [ ] **3.5.2** 技術候補API実装
  - `/api/v1/work-history/technology-suggestions` GET実装
  - クエリパラメータバリデーション
  - レスポンス形式の確認

### 3.6 ルーティング設定
- [ ] **3.6.1** APIエンドポイント登録
  - 新エンドポイントのルーティング追加
  - 認証ミドルウェア設定
  - CORS設定確認

### 3.7 API動作テスト
- [ ] **3.7.1** 職務経歴CRUD API テスト
  - 各エンドポイントのPostmanテスト作成
  - 正常系・異常系のテストケース実行
  - レスポンス形式の確認

- [ ] **3.7.2** 技術候補API テスト
  - 様々なクエリでの検索テスト
  - パフォーマンステスト（レスポンス時間<200ms）

---

## Phase 4: フロントエンド実装 (8-10日)

### 4.1 型定義・ユーティリティ
- [ ] **4.1.1** TypeScript型定義作成
  - `src/types/workHistory.ts`作成
  - API レスポンス型定義
  - フォームデータ型定義
  - 計算結果型定義

- [ ] **4.1.2** API通信ライブラリ実装
  - `src/lib/api/workHistory.ts`作成
  - 全エンドポイント関数実装
  - エラーハンドリング統合
  - ケース変換処理確認

### 4.2 カスタムフック実装
- [ ] **4.2.1** データ取得フック
  - `useWorkHistory.ts`実装
  - データ取得・更新・削除機能
  - ローディング・エラー状態管理

- [ ] **4.2.2** フォーム管理フック
  - `useWorkHistoryForm.ts`実装
  - React Hook Form統合
  - バリデーション設定
  - 一時保存機能

- [ ] **4.2.3** 技術候補フック
  - `useTechnologySuggestions.ts`実装
  - デバウンス機能付き検索
  - カテゴリ別候補取得

### 4.3 共通コンポーネント実装
- [ ] **4.3.1** 技術入力コンポーネント
  - `TechnologyInput.tsx`作成
  - Autocomplete with 複数選択
  - 候補表示・新規追加機能
  - リアルタイム検索

- [ ] **4.3.2** 期間入力コンポーネント
  - `PeriodInput.tsx`作成
  - 年月単位の日付ピッカー
  - 開始日・終了日バリデーション
  - 期間自動計算表示

- [ ] **4.3.3** 統計表示コンポーネント
  - `ExperienceStats.tsx`作成
  - IT経験年数表示
  - 技術スキル別経験年数表示
  - 円グラフまたは棒グラフ表示

### 4.4 職務経歴一覧画面
- [ ] **4.4.1** メイン画面レイアウト
  - `work-history/page.tsx`作成
  - ヘッダー・統計・一覧の配置
  - レスポンシブ対応

- [ ] **4.4.2** ヘッダーコンポーネント
  - `WorkHistoryHeader.tsx`作成
  - タイトル・PDF出力・保存ボタン配置
  - 一時保存状態表示

- [ ] **4.4.3** 統計セクション
  - `WorkHistoryStats.tsx`作成
  - IT経験年数の表示
  - 技術スキルサマリー表示
  - 折りたたみ機能

### 4.5 職務経歴カードコンポーネント
- [ ] **4.5.1** カード表示コンポーネント
  - `WorkHistoryCard.tsx`作成
  - 職務経歴情報の表示
  - 編集・削除ボタン配置
  - 展開・折りたたみ機能

- [ ] **4.5.2** 職務経歴一覧
  - `WorkHistoryList.tsx`作成
  - カードの一覧表示
  - 新規追加ボタン
  - 空状態の表示

### 4.6 職務経歴編集ダイアログ
- [ ] **4.6.1** 編集ダイアログ基本構造
  - `WorkHistoryEditDialog.tsx`作成
  - モーダル形式の実装
  - フォーム項目の配置

- [ ] **4.6.2** 基本情報セクション
  - プロジェクト名・期間・業種入力
  - チーム規模・役割入力
  - リアルタイムバリデーション

- [ ] **4.6.3** 詳細情報セクション
  - プロジェクト概要・担当業務入力
  - 成果・実績・備考入力
  - 担当工程の複数選択

- [ ] **4.6.4** 技術情報セクション
  - プログラミング言語入力（候補付き）
  - サーバー・DB入力（候補付き）
  - ツール入力（候補付き）

### 4.7 PDF出力機能
- [ ] **4.7.1** PDF出力ダイアログ
  - `PDFOutputDialog.tsx`作成
  - 参画開始可能日入力
  - プレビュー機能（将来実装用）
  - 出力ボタン・進行状況表示

- [ ] **4.7.2** PDF出力処理
  - ファイルダウンロード処理
  - エラー処理・ローディング表示
  - 成功時のメッセージ表示

### 4.8 フロントエンド動作テスト
- [ ] **4.8.1** 個別コンポーネントテスト
  - 各コンポーネントの表示確認
  - 入力操作・バリデーション確認
  - エラー状態の表示確認

- [ ] **4.8.2** 統合テスト
  - 画面間遷移テスト
  - API通信テスト
  - データ保存・読み込みテスト

---

## Phase 5: PDF生成機能 (4-5日)

### 5.1 HTMLテンプレート作成
- [ ] **5.1.1** 基本レイアウト作成
  - `templates/work_history.html`作成
  - A4縦向きのCSSスタイル設定
  - 日本語フォント指定

- [ ] **5.1.2** ヘッダー・フッター実装
  - タイトル・出力日時表示
  - ページ番号設定
  - 会社ロゴ配置（将来対応）

- [ ] **5.1.3** 基本情報セクション
  - 氏名・年齢・性別表示
  - 最寄り駅・出張可否表示
  - IT経験年数・参画開始可能日表示

### 5.2 動的コンテンツ実装
- [ ] **5.2.1** 職務経歴セクション
  - 職務経歴一覧のテーブル表示
  - プロジェクト詳細情報
  - 使用技術の整理表示

- [ ] **5.2.2** 技術スキルサマリー
  - カテゴリ別技術一覧
  - 経験年数・プロジェクト数表示
  - 見やすい表形式

- [ ] **5.2.3** その他セクション
  - アピールポイント表示
  - 保有資格一覧
  - 空データ時の表示制御

### 5.3 PDF生成サービス実装
- [ ] **5.3.1** PDFサービス基本実装
  - `WorkHistoryPDFService`作成
  - HTMLテンプレート読み込み
  - データバインディング機能

- [ ] **5.3.2** wkhtmltopdf実行部
  - コマンド実行・オプション設定
  - エラーハンドリング
  - タイムアウト設定（30秒）

- [ ] **5.3.3** ファイル名生成
  - `職務経歴_氏名_日時.pdf`形式
  - 特殊文字のエスケープ処理
  - 文字化け対策

### 5.4 PDFハンドラー実装
- [ ] **5.4.1** エンジニア向けPDF出力
  - `GET /api/v1/work-history/pdf`実装
  - 認証・権限チェック
  - 参画開始可能日パラメータ処理

- [ ] **5.4.2** 管理者向けPDF出力
  - `GET /api/v1/admin/engineers/work-history/:id/pdf`実装
  - 管理者権限チェック
  - 他ユーザーデータアクセス制御

### 5.5 PDF生成テスト
- [ ] **5.5.1** 基本動作テスト
  - サンプルデータでのPDF生成
  - 文字化け・レイアウト確認
  - 各種ブラウザでの表示確認

- [ ] **5.5.2** エラーケーステスト
  - データなし時の動作確認
  - 大量データ時の処理確認
  - PDF生成失敗時のエラーハンドリング

---

## Phase 6: テスト・品質保証 (3-4日)

### 6.1 単体テスト
- [ ] **6.1.1** バックエンド単体テスト
  - 計算ロジックテスト（20パターン以上）
  - バリデーションテスト（全項目）
  - API ハンドラーテスト

- [ ] **6.1.2** フロントエンド単体テスト
  - コンポーネントテスト（Jest + Testing Library）
  - カスタムフックテスト
  - ユーティリティ関数テスト

### 6.2 統合テスト
- [ ] **6.2.1** API統合テスト
  - 全エンドポイントの動作確認
  - データ作成・更新・削除の整合性確認
  - エラーハンドリングの確認

- [ ] **6.2.2** フロントエンド統合テスト
  - ページ表示・遷移テスト
  - フォーム入力・送信テスト
  - API通信・エラー表示テスト

### 6.3 E2Eテスト
- [ ] **6.3.1** 主要シナリオテスト
  - 職務経歴の新規登録→編集→削除
  - 技術入力・候補選択
  - PDF出力（ダウンロード確認）

- [ ] **6.3.2** エラーシナリオテスト
  - バリデーションエラー表示
  - ネットワークエラー処理
  - 権限エラー処理

### 6.4 パフォーマンステスト
- [ ] **6.4.1** 大量データテスト
  - 100件の職務経歴での動作確認
  - API レスポンス時間測定
  - ページ表示速度測定

- [ ] **6.4.2** PDF生成パフォーマンス
  - 大量データでのPDF生成時間測定
  - メモリ使用量確認
  - 同時アクセス時の動作確認

---

## Phase 7: 名称変更・移行作業 (2-3日)

### 7.1 エンドポイント名変更
- [ ] **7.1.1** 新エンドポイント追加
  - `/api/v1/work-history`系のエンドポイント追加
  - 既存`/api/v1/skill-sheet`との併存設定

- [ ] **7.1.2** 段階的移行
  - フロントエンドで新エンドポイント使用開始
  - 旧エンドポイントのアクセスログ監視
  - 移行完了後の旧エンドポイント削除

### 7.2 画面・メニュー名変更
- [ ] **7.2.1** メニュー表示名変更
  - サイドメニュー「スキルシート」→「職務経歴」
  - パンくずリスト更新
  - ページタイトル更新

- [ ] **7.2.2** 画面内表示名変更
  - 各種ボタン・ラベルの更新
  - エラーメッセージの更新
  - ヘルプテキストの更新

### 7.3 ファイル名・コンポーネント名変更
- [ ] **7.3.1** フロントエンドファイル名変更
  - `skill-sheet` → `work-history`ディレクトリ名変更
  - コンポーネント名の段階的変更
  - インポートパスの更新

- [ ] **7.3.2** バックエンドファイル名変更
  - 新規作成ファイルは新命名規則適用済み
  - 既存ファイルは機能追加時に段階的変更

### 7.4 データ移行・最終確認
- [ ] **7.4.1** 既存データ確認
  - 既存スキルシートデータの互換性確認
  - 計算結果の整合性確認
  - PDF出力結果の比較確認

- [ ] **7.4.2** 最終動作確認
  - 全機能の動作確認
  - 複数ユーザーでの動作確認
  - 管理者機能の動作確認

---

## 🎯 各フェーズの完了基準

### Phase 1 完了基準
- [ ] 開発環境でwkhtmltopdfが正常実行できる
- [ ] 必要ディレクトリとファイルが作成済み
- [ ] Docker環境が正常起動する

### Phase 2 完了基準
- [ ] 全マイグレーションが正常実行できる
- [ ] ビューから正しいデータが取得できる
- [ ] サンプルデータで計算結果が正しい

### Phase 3 完了基準
- [ ] 全APIエンドポイントが正常動作する
- [ ] Postmanで全機能テスト完了
- [ ] API レスポンス時間が要件内（<500ms）

### Phase 4 完了基準
- [ ] 全画面が正常表示される
- [ ] フォーム入力・バリデーションが動作する
- [ ] API通信が正常に行われる

### Phase 5 完了基準
- [ ] PDF が正常生成される
- [ ] 日本語表示に問題がない
- [ ] レイアウトが仕様通り

### Phase 6 完了基準
- [ ] 単体テストが95%以上成功
- [ ] 統合テストが全て成功
- [ ] パフォーマンス要件を満たす

### Phase 7 完了基準
- [ ] 名称変更が完了している
- [ ] 既存機能に影響がない
- [ ] 全機能が新名称で動作する

---

## 🚀 開発期間見積もり

- **Phase 1**: 1-2日
- **Phase 2**: 2-3日
- **Phase 3**: 5-7日
- **Phase 4**: 8-10日
- **Phase 5**: 4-5日
- **Phase 6**: 3-4日
- **Phase 7**: 2-3日

**合計**: 25-34日（約5-7週間）

## 📝 注意事項

1. **並行作業**: Phase 2とPhase 3の一部は並行実行可能
2. **テスト**: 各Phase完了時に必ず動作確認を実施
3. **レビュー**: 主要なコンポーネント作成後はコードレビューを実施
4. **ドキュメント**: 実装完了と同時にドキュメントを更新
5. **バックアップ**: 大きな変更前は必ずデータベースバックアップを取得