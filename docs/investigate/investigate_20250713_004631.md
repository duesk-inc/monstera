# サイドメニューレイアウト調査報告書

## 調査日時
2025-07-13 00:46:31

## 調査対象
- サイドメニューとメインコンテンツのレイアウト問題
- ブランチ: feature/sidebar-layout

## 問題の概要
ユーザーから報告された問題：
1. サイドメニューが閉じている時、メインコンテンツの左側に余計な余白がある
2. サイドメニューが開いている時、メインコンテンツがさらに右に移動し、画面からはみ出す

## 調査結果

### 1. 関連ファイル
- `/frontend/src/components/ui/Sidebar.tsx` - 通常のサイドバーコンポーネント
- `/frontend/src/components/ui/AdminSidebar.tsx` - 管理者用サイドバーコンポーネント
- `/frontend/src/components/common/layout/SharedLayoutWrapper.tsx` - 共通レイアウトラッパー
- `/frontend/src/app/(authenticated)/layout.tsx` - 認証済みユーザー用レイアウト
- `/frontend/src/app/(admin)/layout.tsx` - 管理者用レイアウト

### 2. 現在の実装状況

#### Sidebar.tsx
- 幅: 開いている時 240px、閉じている時 68px
- 位置: `position: fixed`
- z-index: 1200

#### AdminSidebar.tsx
- 幅: 開いている時 280px、閉じている時 68px
- MUIのDrawerコンポーネント使用（`variant="permanent"`）

#### SharedLayoutWrapper.tsx
- メインコンテンツのmarginLeft: サイドバーの幅（sidebarWidth）をそのまま使用
- サイドバーが開いている時: 240px or 280px
- サイドバーが閉じている時: 68px

### 3. 問題の根本原因

1. **レイアウト方式の不整合**
   - サイドバーが`position: fixed`で通常のドキュメントフローから外れている
   - メインコンテンツが`marginLeft`でサイドバーの幅分だけオフセットされている
   - この二重のスペース確保により、意図しない余白が生じる

2. **固定位置とマージンの競合**
   - サイドバーが固定位置にあるにも関わらず、メインコンテンツがマージンで避けようとしている
   - サイドバーが開いた時、メインコンテンツが過度に右に押し出される

### 4. 技術的制約
- Material-UIのDrawerコンポーネントとカスタムサイドバーコンポーネントの混在
- レスポンシブ対応（モバイル/デスクトップ）の考慮が必要
- 既存のz-indexやレイアウト構造への影響を最小限に抑える必要がある

## 解決方針

### 推奨アプローチ: Flexboxレイアウトへの統一

1. **サイドバーの位置設定を変更**
   - `position: fixed`を削除
   - 通常のflexboxフローに組み込む

2. **SharedLayoutWrapperの改修**
   - `marginLeft`による調整を削除
   - flexboxコンテナとして動作するように変更
   - サイドバー: `flex-shrink: 0`で固定幅を維持
   - メインコンテンツ: `flex-grow: 1`で残りのスペースを使用

3. **期待される動作**
   - サイドバーが閉じている時: メインコンテンツが広く表示される
   - サイドバーが開いている時: メインコンテンツがサイドバーの幅分だけ縮小される
   - 画面からのはみ出しを防止

### 実装影響範囲
1. Sidebar.tsx - position設定の変更
2. AdminSidebar.tsx - Drawerコンポーネントの設定調整
3. SharedLayoutWrapper.tsx - レイアウトロジックの改修

## 次のステップ
1. 詳細な実装計画の作成（PLANフェーズ）
2. 各コンポーネントの修正
3. レスポンシブ動作の確認
4. クロスブラウザテスト

## リスクと考慮事項
- 既存のz-index階層への影響
- モバイルレイアウトへの影響
- アニメーション効果の維持
- スクロール動作の確認