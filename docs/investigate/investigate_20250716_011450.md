# ENGINEER_STATUS Export Missing Error 調査結果

## 調査概要
- **日時**: 2025-07-16 01:14:50
- **対象**: "Export ENGINEER_STATUS doesn't exist in target module" エラー
- **ブランチ**: fix/engineer-status-exports 
- **エラー箇所**: `src/components/admin/engineers/StatusChangeDialog.tsx`

## エラー詳細
```
Export ENGINEER_STATUS doesn't exist in target module
./src/components/admin/engineers/StatusChangeDialog.tsx
```

### エラー発生箇所
```typescript
// src/components/admin/engineers/StatusChangeDialog.tsx (line 24-28)
import { 
  ENGINEER_STATUS,  // ← エラー: 存在しないexport
  ENGINEER_STATUS_LABELS,
  ENGINEER_STATUS_COLORS
} from '@/constants/engineer';
```

## 根本原因分析

### 1. 欠落しているExport
`constants/engineer.ts` ファイルで以下がエクスポートされていない：
- ❌ `ENGINEER_STATUS` オブジェクト（存在しない）
- ✅ `ENGINEER_STATUS_LABELS: Record<EngineerStatus, string>`
- ✅ `ENGINEER_STATUS_COLORS: Record<EngineerStatus, string>`

### 2. 型定義の存在確認
`types/engineer.ts` では正常に定義されている：
```typescript
// line 324-329
export enum EngineerStatus {
  ACTIVE = 'active',
  STANDBY = 'standby', 
  RESIGNED = 'resigned',
  LONG_LEAVE = 'long_leave'
}
```

### 3. バックエンドとの整合性
Go言語側では正常に定義されている：
```go
// backend/internal/model/engineer_status_history.go (line 47-50)
EngineerStatusActive    = "active"
EngineerStatusStandby   = "standby"
EngineerStatusResigned  = "resigned"
EngineerStatusLongLeave = "long_leave"
```

## 影響範囲分析

### 直接影響ファイル（同様のエラー発生）
1. **StatusChangeDialog.tsx** (line 24-28) - 調査発端
   - 使用箇所: `ENGINEER_STATUS.RESIGNED`, `ENGINEER_STATUS.LONG_LEAVE`, `ENGINEER_STATUS.ACTIVE`

2. **EngineerForm.tsx** (line 27)
   - 使用箇所: `ENGINEER_STATUS.ACTIVE` (default value)

3. **テストファイル**:
   - `__tests__/EngineerList.test.tsx` (line 12)
   - `__tests__/EngineerForm.test.tsx` (line 13)

### 問題のあるテストデータ
テストファイルで未定義の値が使用されている：
```typescript
// EngineerList.test.tsx
engineerStatus: ENGINEER_STATUS.ON_PROJECT  // ← 存在しない値
```

## 技術的分析

### 既存プロジェクトのパターン
他のエンティティでは以下のパターンを採用：
```typescript
// expense.ts の例
export const EXPENSE_STATUS = {
  DRAFT: 'draft',
  SUBMITTED: 'submitted',
  // ...
} as const;

export const EXPENSE_STATUS_LABEL = {
  [EXPENSE_STATUS.DRAFT]: '下書き',
  // ...
} as const;
```

### `engineer.ts` の現在の実装
```typescript
// EngineerStatus enumをインポートして使用
import { EngineerStatus } from '@/types/engineer';

// LABELS と COLORS は定義済み
export const ENGINEER_STATUS_LABELS: Record<EngineerStatus, string> = { ... };
export const ENGINEER_STATUS_COLORS: Record<EngineerStatus, string> = { ... };

// しかし ENGINEER_STATUS オブジェクト自体は未定義
```

## 解決方針

### 推奨解決策（選択肢 A）
**`constants/engineer.ts` に `ENGINEER_STATUS` オブジェクトを追加**

```typescript
// constants/engineer.ts に追加
export const ENGINEER_STATUS = EngineerStatus;
```

**メリット**:
- 最小限の変更（1行追加のみ）
- 既存コードの変更不要
- 他のエンティティとの設計一貫性
- TypeScript型安全性維持

**デメリット**:
- enum と定数オブジェクトの重複

### 代替案（選択肢 B）
**各ファイルのインポートを修正**

```typescript
// Before
import { ENGINEER_STATUS } from '@/constants/engineer';
// After  
import { EngineerStatus } from '@/types/engineer';

// 使用箇所も変更
ENGINEER_STATUS.ACTIVE → EngineerStatus.ACTIVE
```

**メリット**:
- enum の直接使用で型安全性向上
- 重複定義の回避

**デメリット**:
- 4つのファイルの修正が必要
- 既存コードパターンとの不整合

### テストファイル修正（必須）
`ON_PROJECT` 値の修正：
```typescript
// Before
ENGINEER_STATUS.ON_PROJECT  // ← 存在しない

// After（例）
ENGINEER_STATUS.ACTIVE      // 既存の値を使用
```

## 実装計画

### フェーズ1: 緊急修正（推奨）
1. `constants/engineer.ts` に `export const ENGINEER_STATUS = EngineerStatus;` を追加
2. TypeScript コンパイル確認
3. ビルドエラーの解消確認

### フェーズ2: テストファイル修正
1. `ON_PROJECT` 値を有効な値に修正
2. テスト実行・通過確認

### フェーズ3: 品質保証
1. 既存機能の動作確認
2. エンジニア管理画面の動作テスト
3. ステータス変更機能のテスト

## リスク分析

### Low Risk
- **既存機能への影響**: enum値をそのまま使用するため影響なし
- **TypeScript型安全性**: 維持される
- **バックエンド整合性**: 変更なし

### Medium Risk  
- **テストファイルの修正**: `ON_PROJECT` 値の適切な置換が必要

### 推奨事項
- **即座の実装**: 選択肢 A による緊急修正
- **テストファイル修正**: `ON_PROJECT` の適切な値への変更
- **動作確認**: エンジニア管理機能の包括的テスト

## 検証方法

### 1. ビルド検証
```bash
cd frontend && npm run build
```

### 2. 開発環境での動作確認
```bash
make dev
# ブラウザでエンジニア管理画面を確認
```

### 3. テスト実行
```bash
cd frontend && npm run test
```

### 4. 該当機能の動作確認
- エンジニア一覧表示
- エンジニア新規登録（デフォルトステータス: ACTIVE）
- ステータス変更ダイアログ（RESIGNED, LONG_LEAVE への変更）

## 関連ファイル

### 修正対象
- `frontend/src/constants/engineer.ts` - `ENGINEER_STATUS` export 追加

### 影響範囲
- `frontend/src/components/admin/engineers/StatusChangeDialog.tsx`
- `frontend/src/components/admin/engineers/EngineerForm.tsx`
- `frontend/src/components/admin/engineers/__tests__/EngineerList.test.tsx`
- `frontend/src/components/admin/engineers/__tests__/EngineerForm.test.tsx`

### 関連定義
- `frontend/src/types/engineer.ts` - EngineerStatus enum定義
- `backend/internal/model/engineer_status_history.go` - バックエンド定数

## 完了基準

### 必須基準
- [x] 根本原因の特定
- [x] 影響範囲の調査
- [x] 解決方針の決定
- [ ] TypeScript コンパイルエラーの解消
- [ ] エンジニア管理機能の正常動作

### 推奨基準
- [ ] テストファイルの修正
- [ ] 回帰テストの実行
- [ ] 設計一貫性の確保

## 次フェーズ

### 実装フェーズ移行条件
- [x] 調査完了
- [x] 解決方針決定
- [ ] 実装計画承認

### 実装タスク
1. `constants/engineer.ts` への `ENGINEER_STATUS` 追加
2. テストファイルの `ON_PROJECT` 値修正
3. 動作確認・品質検証

## ログ
- **エラー発見**: エンジニア管理週報機能でのビルドエラー
- **調査開始**: 2025-07-16 01:14:50
- **根本原因特定**: `ENGINEER_STATUS` export の欠落
- **解決方針決定**: constants/engineer.ts への追加
- **次フェーズ**: PLAN → IMPLEMENT