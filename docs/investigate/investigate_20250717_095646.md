# 調査報告書: @/constants/auth モジュール解決エラー

## 調査概要

**調査日時**: 2025-07-17 09:56:46  
**調査者**: Claude Code  
**ブランチ**: feature/fix-auth-constants-error  
**エラー概要**: Module not found: Can't resolve '@/constants/auth'

## エラー詳細

```
Build Error

Module not found: Can't resolve '@/constants/auth'

./src/middleware.ts (4:1)

Module not found: Can't resolve '@/constants/auth'
  2 | import type { NextRequest } from 'next/server';
  3 | import { ROUTES, PUBLIC_PATHS } from '@/constants/routes';
> 4 | import { AUTH_COOKIES } from '@/constants/auth';
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  5 |
  6 | // デバッグモード
  7 | const DEBUG_MODE = process.env.NODE_ENV === 'development';
```

## 根本原因分析

### 1. 不足ファイルの特定

調査により、以下の2つの定数ファイルが存在しないことが判明：

1. **`@/constants/auth.ts`** - 認証関連定数
2. **`@/constants/routes.ts`** - ルート関連定数

### 2. middleware.tsでの使用状況

```typescript
// 現在のインポート（エラー発生箇所）
import { ROUTES, PUBLIC_PATHS } from '@/constants/routes';
import { AUTH_COOKIES } from '@/constants/auth';

// 使用箇所
- AUTH_COOKIES.ACCESS_TOKEN (53行目)
- ROUTES.LOGIN (99, 109, 118行目)
- ROUTES.DASHBOARD (122行目)
- PUBLIC_PATHS (17行目)
```

### 3. 既存constants/ディレクトリの状況

```
frontend/src/constants/
├── accounting.ts
├── business-rules.ts
├── cache.ts
├── date.ts
├── defaultWorkTime.ts
├── delays.ts
├── dimensions.ts
├── engineer.ts
├── errorMessages.ts
├── expense.ts
├── moodOptions.ts
├── pagination.ts
├── sales.ts
├── typography.ts
├── ui.ts
├── validationMessages.ts
├── weeklyMood.ts
└── weeklyReport.ts
```

**結果**: `auth.ts`と`routes.ts`が存在しない

## 技術仕様調査結果

### 1. 認証システム仕様

バックエンド認証仕様書（`docs/01_backend/implementation/auth-implementation.md`）から取得：

**Cookie名定義**:
- アクセストークン: `"access_token"`
- リフレッシュトークン: `"refresh_token"`

**設定構造**:
```go
type JWTConfig struct {
    AccessCookieName    string // アクセストークンCookie名
    RefreshCookieName   string // リフレッシュトークンCookie名
}
```

### 2. ルート構造分析

Next.js App Routerディレクトリ構造から推測：

**認証関連ルート**:
- ログインページ: `/login` (`app/(auth)/login/page.tsx`)

**ダッシュボード関連ルート**:
- エンジニアダッシュボード: `/dashboard` (`app/(authenticated)/(engineer)/dashboard/page.tsx`)
- 管理者ダッシュボード: `/admin/dashboard` (`app/(admin)/admin/dashboard/page.tsx`)

**公開パス（認証不要パス）**:
- `/login` - ログインページ
- `/` - ルートページ
- 静的ファイル（middleware設定で除外）

## 解決方針

### 1. 必要な定数ファイルの作成

#### A. `constants/auth.ts`

```typescript
export const AUTH_COOKIES = {
  ACCESS_TOKEN: 'access_token',
  REFRESH_TOKEN: 'refresh_token',
} as const;

export type AuthCookies = typeof AUTH_COOKIES;
```

#### B. `constants/routes.ts`

```typescript
export const ROUTES = {
  LOGIN: '/login',
  DASHBOARD: '/dashboard',
  ADMIN_DASHBOARD: '/admin/dashboard',
} as const;

export const PUBLIC_PATHS = [
  '/',
  '/login',
] as const;

export type Routes = typeof ROUTES;
export type PublicPaths = typeof PUBLIC_PATHS[number];
```

### 2. 実装優先度

1. **高**: `constants/auth.ts` - middleware.tsの即座の修正に必要
2. **高**: `constants/routes.ts` - middleware.tsの即座の修正に必要
3. **中**: 型定義の追加とエクスポート
4. **低**: 既存コードでの利用箇所の統一

## 技術的制約・考慮事項

### 1. Next.js設定確認

- `@`エイリアスが`src`ディレクトリを指していることを確認済み
- パス解決に問題なし

### 2. TypeScript設定

- 既存のconstants/ファイルと同様の型安全性を確保
- `as const`アサーションの使用

### 3. セキュリティ考慮

- Cookie名は公開情報（ハードコーディング問題なし）
- ルート情報も公開情報

## 次フェーズへの推奨事項

### 実装推奨

**理由**:
1. エラーは明確に特定された不足ファイルが原因
2. 仕様書に基づく適切な定数値が特定済み
3. 実装範囲が限定的で影響範囲が明確
4. 既存コードとの整合性確保が可能

**実装作業項目**:
1. `constants/auth.ts`の作成
2. `constants/routes.ts`の作成
3. middleware.tsビルドエラーの確認
4. 型定義の検証

## 調査結果サマリ

| 項目 | 状況 | 対応要否 |
|------|------|----------|
| エラー原因 | ✅ 特定完了 | - |
| 不足ファイル | ✅ 2ファイル特定 | 🔴 作成必要 |
| 仕様確認 | ✅ 完了 | - |
| 実装方針 | ✅ 決定 | - |
| 影響範囲 | ✅ 限定的 | - |

## 関連ファイル

- `frontend/src/middleware.ts` - エラー発生箇所
- `docs/01_backend/implementation/auth-implementation.md` - 認証仕様書
- `docs/02_frontend/specification.md` - フロントエンド仕様書

---

**ブランチ**: feature/fix-auth-constants-error  
**次フェーズ**: PLAN - 実装計画策定推奨