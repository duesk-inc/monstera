# Pull Request 運用ルール（単独開発向け）

本ドキュメントは、開発者1名で運用する現在の体制でのPR作成・自己レビュー・マージのルールを定義します。小さく早く、安全に進めることを目的とします。

## 基本方針
- 常にPR経由で`main`へ取り込む（軽微なドキュメント修正を除く）。
- PRは小さく、独立・可逆に。目安: 変更ファイル20件以内、純粋コード差分±300行以内。
- CIは必須（lint/build/unit、E2Eスモーク）。失敗時は原因特定→再実行。
- デフォルトはSquash merge。コミットメッセージはPRタイトル＋要点に整形。

## ブランチ/コミット命名
- ブランチ: `<type>/<scope>-<short-topic>`
  - 例: `feat/e2e-weekly-report`, `fix/login-redirect`, `chore/ci-playwright`
- Conventional Commitsでタイトル・コミットを統一
  - 例: `feat(weekly-report): add submit button testid`

## PR テンプレ構成
- タイトル（Conventional Commits準拠）
- 概要（Why/What）
- 主な変更点（箇条書き）
- 影響範囲（Frontend/Backend/DB/CI/Infra）
- 動作確認手順（ローカル/CI）
- リスクとリカバリ（1行で）
- スクリーンショット/ログ（UIやエラー再現がある場合）
- 関連Issue/チケット（任意: `Closes #123`）

## 自己レビュー・チェックリスト
- 変更範囲が最小か（不要な差分やデバッグコードを除去）
- 命名・責務の境界が一貫しているか
- エラーハンドリングとログ方針が統一されているか
- テスト:
  - フロント: Jestでユニット/フック、E2Eスモーク（Playwright）
  - バック: Go `testing` + `testify`（該当レイヤ）
- ドキュメント・スクリプト更新（必要な手順や設定が反映されているか）
- CIが通過しているか（再実行含む）

## E2E（Playwright）運用
- 最小スモークのみ常時実行（ログイン、代表1フロー）。
- CIの認証情報はSecrets（`E2E_EMAIL`/`E2E_PASSWORD`）。未設定時はスキップでグリーン維持。
- 新規UI要素は安定セレクタ（`data-testid`）の追加を検討。

## マージ基準
- CIグリーン、自己レビュー完了、チェックリスト全項目OK。
- リスクがある場合、機能フラグ/段階リリース/ロールバック手順をPRに明記。

## 例外（直接push可）
- READMEやコメントのみの微修正、CI設定の軽微なリネーム等。
- ただしコミットメッセージに理由を明記し、可能な限りPRを使用する。

---
補足:
- 本ドキュメントは`docs/pr-guidelines.md`に配置。PR作成時はテンプレートのチェックボックスで準拠を確認すること。
