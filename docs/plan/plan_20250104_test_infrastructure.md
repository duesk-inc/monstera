# テストインフラストラクチャ改善計画

## 作成日時
2025年1月4日

## 背景
前回のテストフェーズで以下の問題が確認された：
1. 認証ハンドラーのテストが存在しない
2. ミドルウェアのテストが古い構造体定義を使用
3. テストのメンテナンス不足

## 目的
- テストカバレッジの向上
- 既存テストの最新化
- 今後の開発における品質保証の基盤構築

## 実装計画

### Phase 1: 認証ハンドラーテストの追加（優先度: 高）

#### タスク1: auth_handler_test.go の作成
- 基本的なテストケースの実装
  - Login成功ケース
  - Login失敗ケース（無効な認証情報）
  - Login失敗ケース（バリデーションエラー）
  - Logout成功ケース
  - RefreshToken成功/失敗ケース

#### タスク2: モックサービスの準備
- AuthServiceのモック実装
- テスト用のリクエスト/レスポンス構造体

### Phase 2: 既存テストの更新（優先度: 高）

#### タスク1: cognito_auth_test.go の修正
- 古い構造体定義の更新
  - CookieName, Domain等の削除されたフィールドを除去
  - Role型の正しい使用に修正
- テストケースの見直しと更新

### Phase 3: テストユーティリティの整備（優先度: 中）

#### タスク1: テストヘルパー関数の作成
- Ginコンテキストのモック作成ヘルパー
- 認証トークンの生成ヘルパー
- テストユーザーの作成ヘルパー

## 実装順序
1. auth_handler_test.go の作成（最も重要）
2. cognito_auth_test.go の修正
3. テストユーティリティの追加

## 成功基準
- 全テストが正常に実行される
- 認証関連の主要フローがテストでカバーされている
- 今後の開発で参照できるテストパターンが確立される

## 推定工数
- Phase 1: 1-2時間
- Phase 2: 30分-1時間
- Phase 3: 30分

## リスク
- 既存コードの理解不足による不適切なテスト実装
- モックの複雑性による実装遅延

## 備考
- 既存のテストパターンを参考にして実装
- 可能な限りテーブルドリブンテストを使用
- エラーケースを網羅的にカバー