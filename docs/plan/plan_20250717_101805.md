# 実装計画書: @/constants/auth モジュール解決エラー修正

## 計画概要

**計画日時**: 2025-07-17 10:18:05  
**計画者**: Claude Code  
**ブランチ**: feature/fix-auth-constants-error  
**実装目標**: middleware.tsのビルドエラー解消

## 問題要約

**エラー**: Module not found: Can't resolve '@/constants/auth'  
**原因**: 必要な定数ファイル2つが不足  
**影響**: フロントエンドのビルドが不可能

## 実装方針

### 1. 基本方針

- **最小限実装**: エラー解消に必要な最小限のコードのみ実装
- **型安全性**: TypeScript型安全性を完全に確保
- **一貫性**: 既存constantsファイルのパターンに完全準拠
- **将来拡張性**: 将来の機能追加を考慮した設計

### 2. 技術的アプローチ

- **既存パターン踏襲**: 他のconstantsファイルと同様のエクスポート形式
- **`as const`アサーション**: 型推論の最適化とリテラル型の保持
- **命名規則**: プロジェクト標準の命名規則に準拠

## 詳細実装タスク

### Phase 1: 緊急対応（ビルドエラー解消） - 優先度P1

#### 1.1 constants/auth.ts 作成
- **作業時間**: 5分
- **成果物**: `frontend/src/constants/auth.ts`
- **内容**:
  ```typescript
  export const AUTH_COOKIES = {
    ACCESS_TOKEN: 'access_token',
    REFRESH_TOKEN: 'refresh_token',
  } as const;

  export type AuthCookies = typeof AUTH_COOKIES;
  ```

#### 1.2 constants/routes.ts 作成
- **作業時間**: 5分  
- **成果物**: `frontend/src/constants/routes.ts`
- **内容**:
  ```typescript
  export const ROUTES = {
    LOGIN: '/login',
    DASHBOARD: '/dashboard',
    ADMIN_DASHBOARD: '/admin/dashboard',
  } as const;

  export const PUBLIC_PATHS = [
    '/',
    '/login',
  ] as const;

  export type Routes = typeof ROUTES;
  export type PublicPaths = typeof PUBLIC_PATHS[number];
  ```

#### 1.3 ビルドエラー解消確認
- **作業時間**: 3分
- **実行**: `npm run build`
- **期待結果**: ビルド成功

### Phase 2: 品質保証 - 優先度P2

#### 2.1 TypeScript型検証
- **作業時間**: 2分
- **実行**: `npm run type-check` (または `npx tsc --noEmit`)
- **期待結果**: 型エラーなし

#### 2.2 開発サーバー動作確認
- **作業時間**: 2分
- **実行**: `npm run dev`
- **期待結果**: サーバー正常起動

### Phase 3: 統合確認 - 優先度P3

#### 3.1 既存テスト実行
- **作業時間**: 3分
- **実行**: `npm run test`
- **期待結果**: 既存テスト全て通過

#### 3.2 Lint & Format確認
- **作業時間**: 2分
- **実行**: `npm run lint`
- **期待結果**: Lintエラーなし

## ファイル変更計画

### 新規作成ファイル

| ファイルパス | 目的 | サイズ(推定) |
|-------------|------|-------------|
| `frontend/src/constants/auth.ts` | 認証関連定数 | ~15行 |
| `frontend/src/constants/routes.ts` | ルート関連定数 | ~20行 |

### 修正ファイル

**なし** - middleware.tsは既にインポート文が記述済み

### 削除ファイル

**なし**

## テスト戦略

### 1. ビルドテスト

**目的**: モジュール解決エラーの完全解消  
**実行方法**: `npm run build`  
**成功基準**: ビルドプロセスが正常完了すること

### 2. 型検証テスト

**目的**: TypeScript型安全性の確保  
**実行方法**: `npx tsc --noEmit`  
**成功基準**: 型エラーが発生しないこと

### 3. 統合テスト

**目的**: 既存機能との整合性確認  
**実行方法**: `npm run test`  
**成功基準**: 全テストが通過すること

### 4. 実行時テスト

**目的**: 実際の動作確認  
**実行方法**: `npm run dev` でサーバー起動  
**成功基準**: 開発サーバーがエラーなく起動すること

## リスク分析

### 低リスク事項

| リスク項目 | 確率 | 影響度 | 対策 |
|----------|------|--------|------|
| TypeScript型エラー | 低 | 低 | 既存パターン踏襲 |
| Cookie名間違い | 低 | 低 | 仕様書準拠 |
| ルート名間違い | 低 | 低 | App Router構造確認済み |

### 緊急時対応

**問題発生時の対処法**:
1. 作成したファイルを削除
2. `git checkout .` で変更を取り消し
3. mainブランチへの切り戻し

**エスカレーション基準**:
- 2時間以内に解決しない場合（実際の想定は30分以内）

## 品質保証

### 1. コード品質

- **ESLint**: 標準ルールセットに準拠
- **Prettier**: 自動フォーマット適用
- **TypeScript**: strict mode での型チェック

### 2. 設計品質

- **一貫性**: 既存constantsファイルとの統一性
- **可読性**: 明確な命名とコメント
- **保守性**: 将来の変更容易性

### 3. セキュリティ

- **情報漏洩リスク**: なし（公開情報のみ）
- **権限管理**: 認証機能自体は変更なし

## 実装スケジュール

### 即座実行 (T+0分)

1. **constants/auth.ts作成** (5分)
2. **constants/routes.ts作成** (5分)
3. **ビルド確認** (3分)

### 品質確認 (T+15分)

4. **型検証** (2分)
5. **開発サーバー確認** (2分)
6. **テスト実行** (3分)
7. **Lint確認** (2分)

### 完了予定時刻

**全作業完了**: T+25分以内  
**緊急対応完了**: T+15分以内

## 成功基準

### 必須基準（Phase 1）

- ✅ `npm run build` が成功する
- ✅ TypeScriptコンパイルエラーが発生しない
- ✅ middleware.tsがエラーなくインポートできる

### 推奨基準（Phase 2-3）

- ✅ 既存テストが全て通過する
- ✅ Lintエラーが発生しない
- ✅ 開発サーバーが正常起動する

### 品質基準

- ✅ コード品質: 既存水準を維持
- ✅ 型安全性: 完全な型推論サポート
- ✅ 一貫性: プロジェクト標準準拠

## 実装後の確認項目

### 動作確認

- [ ] `npm run build` 成功
- [ ] `npm run dev` 正常起動  
- [ ] `npm run test` 全通過
- [ ] `npm run lint` エラーなし

### コード品質確認

- [ ] TypeScript型エラーなし
- [ ] ESLint/Prettier準拠
- [ ] 既存パターンとの一貫性

### ドキュメント更新

- [ ] 実装完了報告書作成
- [ ] CLAUDE.mdの更新（必要に応じて）

## 関連資料

### 参照仕様書

- `docs/investigate/investigate_20250717_095646.md` - 調査結果
- `docs/01_backend/implementation/auth-implementation.md` - 認証仕様
- `docs/02_frontend/specification.md` - フロントエンド仕様

### 関連ファイル

- `frontend/src/middleware.ts` - 修正対象（インポート元）
- `frontend/src/constants/*.ts` - 既存パターン参考

---

## 実装承認

**計画レビュー**: ✅ 完了  
**技術妥当性**: ✅ 確認済み  
**リスク評価**: ✅ 低リスク認定  
**実装準備**: ✅ 完了

**次フェーズ**: IMPLEMENT - 実装実行

---

**ブランチ**: feature/fix-auth-constants-error  
**プランファイル**: docs/plan/plan_20250717_101805.md