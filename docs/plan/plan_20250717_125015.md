# 実装計画書: API_TIMEOUTS 定数不足エラー解決

## 計画概要

**計画日時**: 2025-07-17 12:50:15  
**計画者**: Claude Code  
**ブランチ**: feature/fix-auth-constants-error (継続)  
**対象問題**: API_TIMEOUTS、TIME_THRESHOLDS、UI_DELAYS拡張の不足によるビルドエラー  
**実装目標**: 不足定数追加による即座のビルドエラー解消

## 前提条件

### 調査結果サマリー
- **調査完了**: docs/investigate/investigate_20250717_112835.md に詳細記載
- **エラー箇所**: src/lib/api/index.ts:4 でのインポートエラー
- **不足定数**: API_TIMEOUTS、TIME_THRESHOLDS、UI_DELAYS拡張
- **影響範囲**: ビルドエラーのため高優先度対応が必要

### 技術要件
- **後方互換性**: 既存のAPI_DELAYS、THROTTLE_DELAYS、DEBOUNCE_DELAYSは保持
- **型安全性**: TypeScript strict mode での型チェック通過
- **値の妥当性**: 実用的なタイムアウト値の設定

## 実装計画

### Phase 1: 定数追加実装

#### Task 1.1: API_TIMEOUTS 定数追加
**ファイル**: `src/constants/delays.ts`
**実装内容**:
```typescript
// API_TIMEOUTS定数を追加
export const API_TIMEOUTS = {
  SHORT: 5000,    // 短時間API用タイムアウト (5秒)
  DEFAULT: 30000, // 標準タイムアウト (30秒)
} as const;
```
**根拠**: 
- SHORT: 高速APIレスポンス想定、ユーザー体験優先
- DEFAULT: 既存NETWORK_TIMEOUTS.DEFAULTと整合性確保

#### Task 1.2: TIME_THRESHOLDS 定数追加
**ファイル**: `src/constants/delays.ts`
**実装内容**:
```typescript
// TIME_THRESHOLDS定数を追加
export const TIME_THRESHOLDS = {
  IMMEDIATE: 3000, // 即時判定閾値 (3秒)
} as const;
```
**根拠**: src/lib/api/index.ts:121のコメント「3秒以内」に基づく

#### Task 1.3: UI_DELAYS 拡張
**ファイル**: `src/constants/delays.ts`
**実装内容**:
```typescript
// 既存のUI_DELAYSを拡張
export const UI_DELAYS = {
  TOOLTIP_SHOW: 500,
  TOOLTIP_HIDE: 100,
  DROPDOWN_SHOW: 100,
  DROPDOWN_HIDE: 150,
  MODAL_SHOW: 200,
  MODAL_HIDE: 200,
  ALERT_AUTO_HIDE: 5000,
  NOTIFICATION_AUTO_HIDE: 4000,
  SNACKBAR_AUTO_HIDE: 3000,
  THROTTLE: 300,   // 新規追加: UIスロットル遅延
  DEBOUNCE: 500,   // 新規追加: UIデバウンス遅延
} as const;
```
**根拠**: 既存THROTTLE_DELAYS.CLICK、DEBOUNCE_DELAYS.INPUTと整合

#### Task 1.4: 型定義追加
**ファイル**: `src/constants/delays.ts`
**実装内容**:
```typescript
// 新規型定義を追加
export type ApiTimeouts = typeof API_TIMEOUTS[keyof typeof API_TIMEOUTS];
export type TimeThresholds = typeof TIME_THRESHOLDS[keyof typeof TIME_THRESHOLDS];
```

### Phase 2: ビルド検証

#### Task 2.1: TypeScript型チェック
**コマンド**: `npm run type-check`
**期待結果**: エラー0件

#### Task 2.2: ビルド実行
**コマンド**: `npm run build`
**期待結果**: 
- ビルド成功
- API_TIMEOUTSインポートエラー解消確認

#### Task 2.3: 開発サーバー起動確認
**コマンド**: `npm run dev`
**期待結果**: サーバー正常起動、ランタイムエラーなし

### Phase 3: テスト実行

#### Task 3.1: 基本動作テスト
**対象**: 定数値の正常インポート・使用
**検証内容**:
- API_TIMEOUTS.SHORT が 5000
- API_TIMEOUTS.DEFAULT が 30000
- TIME_THRESHOLDS.IMMEDIATE が 3000
- UI_DELAYS.THROTTLE が 300
- UI_DELAYS.DEBOUNCE が 500

#### Task 3.2: lib/api/index.ts 動作確認
**検証内容**:
- axios設定での API_TIMEOUTS.SHORT 使用確認
- DEFAULT_TIMEOUT での API_TIMEOUTS.DEFAULT 使用確認
- エラー処理での TIME_THRESHOLDS.IMMEDIATE 使用確認
- リダイレクト処理での UI_DELAYS 使用確認

#### Task 3.3: 既存機能回帰テスト
**対象**: 既存のdelay定数使用箇所
**検証内容**:
- 既存のAPI_DELAYS動作確認
- 既存のTHROTTLE_DELAYS動作確認
- 既存のDEBOUNCE_DELAYS動作確認

## リスク分析と対策

### リスク 1: 既存機能への影響
**リスク内容**: 新規定数追加が既存機能に悪影響
**対策**: 
- 既存定数は変更しない
- 新規定数のみ追加
- 段階的な実装とテスト

### リスク 2: 値の不適切性
**リスク内容**: タイムアウト値が実用に適さない
**対策**:
- 既存値との整合性確保
- 実績のある値を採用
- 必要に応じて調整可能な設計

### リスク 3: 型安全性の問題
**リスク内容**: TypeScript型定義の不整合
**対策**:
- 厳密な型定義作成
- TypeScriptコンパイラによる検証
- as const による型推論活用

## 成功基準

### 必須条件
- ✅ ビルドエラーの完全解消
- ✅ TypeScript型チェック通過
- ✅ 開発サーバー正常起動
- ✅ 既存機能の動作確認

### 品質条件
- ✅ 一貫したコーディング規約の遵守
- ✅ 適切な値の設定
- ✅ 明確な型定義
- ✅ 後方互換性の維持

## 実装スケジュール

### 即座実行 (優先度: High)
1. **定数追加実装** (5分)
   - API_TIMEOUTS追加
   - TIME_THRESHOLDS追加
   - UI_DELAYS拡張
   - 型定義追加

2. **ビルド検証** (3分)
   - TypeScript型チェック
   - ビルド実行
   - エラー解消確認

3. **基本動作確認** (2分)
   - 開発サーバー起動
   - 定数値確認
   - インポート動作確認

### 追加検証 (優先度: Medium)
4. **詳細テスト** (10分)
   - lib/api/index.ts動作確認
   - 既存機能回帰テスト
   - タイムアウト動作テスト

## 実装後の確認事項

### 技術確認
- [ ] ビルドエラー解消
- [ ] TypeScript型チェック通過
- [ ] 開発サーバー正常起動
- [ ] インポートエラーなし

### 機能確認
- [ ] API設定でのタイムアウト動作
- [ ] エラー処理での閾値判定動作
- [ ] UI操作でのdelay動作
- [ ] 既存機能の正常動作

### 品質確認
- [ ] コーディング規約遵守
- [ ] 型安全性確保
- [ ] 後方互換性維持
- [ ] 値の妥当性確認

## 備考

### 実装上の注意点
- 既存のdelays.tsファイル構造を維持
- as const を使用した型推論の活用
- 既存定数との命名一貫性確保
- 適切なコメント追加

### 将来への拡張性
- 新規タイムアウト値の追加容易性
- 既存値の調整可能性
- 型定義の拡張可能性
- 他ファイルでの再利用性

---

**計画完了日時**: 2025-07-17 12:50:15  
**次フェーズ**: Implementation - 即座実装開始推奨  
**実装担当**: Claude Code  
**承認者**: User Approval Required