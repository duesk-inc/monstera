# 職務経歴メニュー削除リファクタリング計画書

## 計画日時
2025年1月15日

## 1. 概要

### 1.1 目的と期待効果
- **目的**: 重複している職務経歴機能を削除し、スキルシートに統一
- **期待効果**:
  - ユーザビリティの向上（混乱の解消）
  - 保守コストの削減（約50%削減）
  - コードベースの簡素化（約30コンポーネント削除）

### 1.2 スコープ
#### 削除対象
- 職務経歴メニューアイテム
- 職務経歴ページ（/work-history）
- WorkHistory関連コンポーネント（30ファイル）
- WorkHistory関連フック（11ファイル）
- WorkHistory API関数
- 関連する型定義（一部）

#### 残存対象
- スキルシート機能（拡張予定）
- WorkHistory型定義（スキルシートで使用）

## 2. 現状と改善後の比較

### 2.1 Before（現状）
```
[メニュー構成]
- ダッシュボード
- 週報
- 経費申請
- 休暇申請
- スキルシート ←── 職務経歴管理機能
- 職務経歴    ←── 重複（削除対象）
- 提案管理
- 通知設定
- プロフィール
```

### 2.2 After（改善後）
```
[メニュー構成]
- ダッシュボード
- 週報
- 経費申請
- 休暇申請
- スキルシート ←── 統合された職務経歴管理
- 提案管理
- 通知設定
- プロフィール
```

### 2.3 メトリクス改善予測
| 指標 | 現状 | 改善後 | 改善率 |
|------|------|--------|--------|
| コンポーネント数 | 30 + 30 | 30 | 50%削減 |
| 保守対象ファイル | 41 + α | α | 41ファイル削減 |
| ユーザー混乱度 | 高 | 低 | 大幅改善 |
| API重複 | あり | なし | 100%解消 |

## 3. 実装計画

### Phase 1: メニュー削除とリダイレクト設定（リスク：低）
**期間**: 30分
**作業内容**:
1. EngineerSidebarから職務経歴メニューを削除
2. AdminSidebarから職務経歴メニューを削除（存在する場合）
3. /work-history → /skill-sheet へのリダイレクト設定
4. ビルドテスト実施

**成果物**:
- 更新されたサイドバーコンポーネント
- リダイレクト設定
- テスト結果

### Phase 2: ページコンポーネント削除（リスク：低）
**期間**: 15分
**作業内容**:
1. `/app/(authenticated)/work-history/page.tsx` の削除
2. 関連するルーティング設定の確認
3. ビルドテスト実施

**成果物**:
- 削除されたページファイル
- 正常動作するルーティング

### Phase 3: 統計機能の移植（リスク：中）
**期間**: 45分
**作業内容**:
1. WorkHistoryStatsコンポーネントの機能を分析
2. スキルシートへの統計機能統合方法の検討
3. 必要な機能のスキルシートへの移植
4. 動作確認

**成果物**:
- 拡張されたスキルシート機能
- 統計表示機能

### Phase 4: コンポーネント・フック削除（リスク：低）
**期間**: 30分
**作業内容**:
1. `/components/features/workHistory/` ディレクトリの削除
2. `/hooks/workHistory/` ディレクトリの削除
3. `/lib/api/workHistory.ts` の削除
4. インポートエラーの確認と修正

**成果物**:
- クリーンなコードベース
- 削除完了レポート

### Phase 5: 型定義の整理（リスク：中）
**期間**: 30分
**作業内容**:
1. `/types/workHistory.ts` の確認
2. スキルシートで使用されている型の特定
3. 不要な型定義の削除
4. 必要な型定義の移行

**成果物**:
- 整理された型定義
- 正常にビルドされるプロジェクト

## 4. テスト戦略

### 4.1 Phase毎のテスト
- **Phase 1**: メニュー表示確認、リダイレクト動作確認
- **Phase 2**: 404エラーが発生しないことを確認
- **Phase 3**: 統計機能の正常動作確認
- **Phase 4**: ビルドエラーがないことを確認
- **Phase 5**: TypeScriptコンパイルエラーがないことを確認

### 4.2 統合テスト
```bash
# ビルドテスト
npm run build

# 型チェック
npx tsc --noEmit

# リンティング
npm run lint

# 開発サーバー起動確認
npm run dev
```

### 4.3 ユーザビリティテスト
- スキルシートへのアクセス確認
- 職務経歴データの表示確認
- 編集機能の動作確認

## 5. ロールバック計画

### 5.1 Gitによるロールバック
```bash
# Phase毎にコミット
git add -A && git commit -m "refactor: Phase X - [内容]"

# 問題発生時のロールバック
git revert HEAD
```

### 5.2 バックアップ戦略
- 削除前にブランチを作成
- 各Phaseでタグを付与
- 削除ファイルのアーカイブ保存

### 5.3 緊急復旧手順
1. 最新の正常コミットに戻す
2. メニュー項目を一時的に復活
3. 問題の原因を調査
4. 修正後に再度削除を実施

## 6. リスク管理

### 6.1 技術的リスク
| リスク | 可能性 | 影響度 | 緩和策 |
|--------|--------|--------|--------|
| ビルドエラー | 低 | 中 | Phase毎のビルドテスト |
| 型定義の不整合 | 中 | 低 | 慎重な型定義の移行 |
| 統計機能の欠落 | 中 | 中 | Phase 3での慎重な移植 |

### 6.2 ユーザー影響リスク
| リスク | 可能性 | 影響度 | 緩和策 |
|--------|--------|--------|--------|
| URLブックマーク無効 | 高 | 低 | リダイレクト設定 |
| 機能の一時的欠落 | 低 | 中 | 段階的実装 |
| データアクセス不可 | 極低 | 高 | スキルシートでの代替確認 |

## 7. 影響を受けるドキュメント

### 7.1 更新が必要なドキュメント
- ユーザーマニュアル（職務経歴関連）
- API仕様書（削除エンドポイント）
- 開発者ガイド（機能説明）

### 7.2 削除対象ドキュメント
- WorkHistory関連のREADME
- WorkHistoryコンポーネントのStorybook

## 8. タイムライン

### 実装スケジュール
```
Phase 1: 開始 → 30分後完了
  ↓ テスト（10分）
Phase 2: → 15分後完了
  ↓ テスト（10分）
Phase 3: → 45分後完了
  ↓ テスト（15分）
Phase 4: → 30分後完了
  ↓ テスト（10分）
Phase 5: → 30分後完了
  ↓ 統合テスト（20分）
完了
```

**総所要時間**: 約3時間

## 9. 成功基準

### 9.1 機能面
- ✅ スキルシートから職務経歴を管理可能
- ✅ 統計情報が表示される
- ✅ 既存データへのアクセスが可能

### 9.2 技術面
- ✅ ビルドエラーなし
- ✅ TypeScriptエラーなし
- ✅ Lintエラーなし
- ✅ テスト通過

### 9.3 ユーザビリティ面
- ✅ メニューが簡潔になる
- ✅ 機能の重複がない
- ✅ 直感的な操作が可能

## 10. 次のステップ

削除完了後：
1. スキルシートUIの改善検討
2. 統計機能の拡張
3. パフォーマンス最適化
4. ユーザーフィードバックの収集

## ステータス
**status**: PHASED_APPROACH  
**next**: REFACTOR-IMPLEMENT  
**details**: "段階的リファクタリング計画策定。refactor-plan_20250115_work_history_removal.mdに詳細記録。Phase 1から開始。"