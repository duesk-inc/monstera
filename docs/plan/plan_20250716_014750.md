# ENGINEER_STATUS Export 実装プラン

## 概要
- **日時**: 2025-07-16 01:47:50
- **対象**: ENGINEER_STATUS export missing エラーの解決
- **ブランチ**: fix/engineer-status-exports
- **調査結果**: docs/investigate/investigate_20250716_011450.md

## 調査結果サマリー

### 根本原因
- `frontend/src/constants/engineer.ts` で `ENGINEER_STATUS` オブジェクトが未定義
- 4つのファイルで同様のインポートエラーが発生
- テストファイルで未定義の `ON_PROJECT` 値が使用されている

### 影響範囲
- **StatusChangeDialog.tsx** - ステータス変更ダイアログ
- **EngineerForm.tsx** - エンジニア作成フォーム
- **EngineerList.test.tsx** - エンジニア一覧テスト
- **EngineerForm.test.tsx** - エンジニアフォームテスト

## 採用する解決方針

### 推奨解決策（選択肢 A）
**`constants/engineer.ts` に `ENGINEER_STATUS` オブジェクトを追加**

```typescript
// constants/engineer.ts に追加
export const ENGINEER_STATUS = EngineerStatus;
```

**採用理由**:
- 最小限の変更（1行追加のみ）
- 既存コードの変更不要
- 他のエンティティ（expense.ts等）との設計一貫性
- TypeScript型安全性維持

## 詳細実装タスク

### フェーズ1: 緊急修正（必須）
**優先度: 高**

1. **constants/engineer.ts への ENGINEER_STATUS 追加**
   - `export const ENGINEER_STATUS = EngineerStatus;` を追加
   - 位置: EngineerStatus インポート直後
   - 変更内容: 1行追加のみ

2. **TypeScript コンパイル確認**
   ```bash
   cd frontend && npm run build
   ```

3. **ビルドエラー解消確認**
   - 4つのファイルでのインポートエラーが解消されることを確認

### フェーズ2: テストファイル修正（必須）
**優先度: 高**

4. **ON_PROJECT 値の修正**
   - `EngineerList.test.tsx` で7箇所の `ON_PROJECT` を修正
   - 修正方針: `ENGINEER_STATUS.ACTIVE` に置換
   - 理由: 最も一般的で安全な稼働状態

5. **テスト実行・通過確認**
   ```bash
   cd frontend && npm run test -- --testPathPattern=EngineerList.test.tsx
   cd frontend && npm run test -- --testPathPattern=EngineerForm.test.tsx
   ```

### フェーズ3: 品質保証（推奨）
**優先度: 中**

6. **機能動作確認**
   - エンジニア一覧表示
   - エンジニア新規登録（デフォルトステータス: ACTIVE）
   - ステータス変更ダイアログ動作確認

7. **回帰テスト実行**
   ```bash
   cd frontend && npm run test
   make test-frontend
   ```

## ファイル変更計画

### 修正対象ファイル

#### 1. `frontend/src/constants/engineer.ts`
**変更種別**: 修正
**変更内容**: 
```typescript
// 追加: line 4 付近
export const ENGINEER_STATUS = EngineerStatus;
```

#### 2. `frontend/src/components/admin/engineers/__tests__/EngineerList.test.tsx`
**変更種別**: 修正
**変更内容**: 
```typescript
// 7箇所の修正
// Before: ENGINEER_STATUS.ON_PROJECT
// After:  ENGINEER_STATUS.ACTIVE
```

### 変更なしファイル（影響範囲）
- `frontend/src/components/admin/engineers/StatusChangeDialog.tsx`
- `frontend/src/components/admin/engineers/EngineerForm.tsx`
- `frontend/src/components/admin/engineers/__tests__/EngineerForm.test.tsx`
- `frontend/src/types/engineer.ts`

## テスト戦略

### 1. 単体テスト
**対象**: 修正箇所の動作確認
- `constants/engineer.ts` の ENGINEER_STATUS export 確認
- TypeScript型安全性の確認

### 2. 統合テスト
**対象**: コンポーネント間の連携確認
- StatusChangeDialog での ENGINEER_STATUS 使用確認
- EngineerForm での ENGINEER_STATUS.ACTIVE 使用確認

### 3. 回帰テスト
**対象**: 既存機能の正常動作確認
- エンジニア管理機能全般
- ステータス変更機能
- フォーム送信機能

### 4. Docker環境での実行
```bash
# 開発環境での動作確認
make dev

# フロントエンドテスト実行
make test-frontend

# ビルドテスト
cd frontend && npm run build
```

## リスク分析・対策

### Low Risk
- **既存機能への影響**: enum値をそのまま使用するため影響なし
- **TypeScript型安全性**: EngineerStatus enumを使用するため型安全性は維持
- **バックエンド整合性**: フロントエンドのみの変更のため影響なし

### Medium Risk
- **テストファイルの修正**: `ON_PROJECT` 値の適切な置換が必要
  - **対策**: 最も一般的な `ACTIVE` 状態に統一
  - **確認**: テスト実行で動作確認

### Very Low Risk
- **設計一貫性**: 他のエンティティとの不整合
  - **対策**: 既存の expense.ts パターンと同様の実装

## 実装手順

### ステップ1: 準備確認
1. 現在のブランチ `fix/engineer-status-exports` を確認
2. 最新のコード状態を確認

### ステップ2: 緊急修正実装
1. `constants/engineer.ts` に `ENGINEER_STATUS` 追加
2. TypeScript コンパイル確認
3. ビルドエラー解消確認

### ステップ3: テストファイル修正
1. `EngineerList.test.tsx` の `ON_PROJECT` 値修正
2. テスト実行・通過確認

### ステップ4: 品質保証
1. 機能動作確認
2. 回帰テスト実行
3. Docker環境での確認

## 完了基準

### 必須基準
- [ ] TypeScript コンパイルエラーの解消
- [ ] 4つのファイルでのインポートエラー解消
- [ ] テストファイルの修正完了
- [ ] 修正対象テストの通過

### 推奨基準
- [ ] エンジニア管理機能の正常動作
- [ ] ステータス変更機能の正常動作
- [ ] 全フロントエンドテストの通過
- [ ] 設計一貫性の確保

### 品質基準
- [ ] 既存機能への影響なし
- [ ] TypeScript型安全性の維持
- [ ] バックエンドとの整合性維持

## 検証方法

### 1. ビルド検証
```bash
cd frontend && npm run build
# Expected: コンパイルエラーなし
```

### 2. テスト実行
```bash
cd frontend && npm run test
# Expected: すべてのテストが通過
```

### 3. 機能確認
- エンジニア一覧ページの表示
- エンジニア新規登録
- ステータス変更ダイアログの動作

### 4. 対象機能の動作確認
- StatusChangeDialog: `ENGINEER_STATUS.RESIGNED`, `ENGINEER_STATUS.LONG_LEAVE` の使用
- EngineerForm: `ENGINEER_STATUS.ACTIVE` のデフォルト値使用

## 実装計画承認

### 次フェーズ移行条件
- [x] 調査完了
- [x] 解決方針決定
- [x] 実装計画策定
- [ ] 実装計画承認
- [ ] 実装担当者の決定

### 実装フェーズでの注意事項
1. **最小変更原則**: 必要最小限の修正に留める
2. **既存コード尊重**: 既存の実装パターンを踏襲
3. **段階的実装**: 緊急修正 → テスト修正 → 品質保証の順

## 関連ファイル

### 修正対象
- `frontend/src/constants/engineer.ts`
- `frontend/src/components/admin/engineers/__tests__/EngineerList.test.tsx`

### 影響範囲（修正不要）
- `frontend/src/components/admin/engineers/StatusChangeDialog.tsx`
- `frontend/src/components/admin/engineers/EngineerForm.tsx`
- `frontend/src/components/admin/engineers/__tests__/EngineerForm.test.tsx`

### 関連定義
- `frontend/src/types/engineer.ts` - EngineerStatus enum定義
- `backend/internal/model/engineer_status_history.go` - バックエンド定数

## 次フェーズ

### 実装フェーズ移行
- **移行タイミング**: 本プラン承認後
- **実装内容**: 上記タスクの順次実行
- **完了目標**: TypeScript エラー解消とテスト通過

## ログ
- **調査完了**: 2025-07-16 01:14:50
- **プラン策定**: 2025-07-16 01:47:50
- **次フェーズ**: IMPLEMENT (実装実行)