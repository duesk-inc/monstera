# 経費申請画面への新規作成ボタン追加実装計画

## 計画作成日時
2025-07-24 23:36:44

## 概要
経費申請一覧画面に新規作成ボタンを追加し、ユーザーが新規経費申請画面へアクセスできるようにする。

## 背景
- 経費申請機能は実装済みだが、一覧画面から新規申請画面への導線が欠落している
- 現状、ユーザーは `/expenses/new` へ直接URLを入力しないとアクセスできない
- UI/UXの観点から改善が必要

## 実装方針

### 基本方針
1. **最小限の変更で実装**
   - ExpensesPageコンポーネントのみを修正
   - 既存のコンポーネントとパターンを最大限活用

2. **プロジェクト標準への準拠**
   - PageHeaderのactionsプロップを使用
   - ActionButtonコンポーネントを使用
   - 週報画面の実装パターンを参考

3. **UI/UX標準の遵守**
   - primaryタイプのボタンで視認性を高める
   - アイコンとラベルで機能を明確化
   - レスポンシブ対応

## 詳細実装タスク

### 1. 必要なインポートの追加（優先度：高）
```typescript
import { useRouter } from 'next/navigation';
import ActionButton from '@/components/common/ActionButton';
import { Add as AddIcon } from '@mui/icons-material';
```

### 2. useRouterフックの実装（優先度：高）
```typescript
const router = useRouter();
```

### 3. PageHeaderコンポーネントの更新（優先度：高）
3箇所のPageHeaderすべてにactionsプロップを追加：
- エラー表示時
- ローディング表示時
- 通常表示時

```typescript
<PageHeader
  title="経費申請一覧"
  subtitle="経費申請の作成・管理を行います"
  actions={
    <ActionButton
      buttonType="primary"
      icon={<AddIcon />}
      onClick={() => router.push('/expenses/new')}
    >
      新規作成
    </ActionButton>
  }
/>
```

### 4. 動作確認（優先度：高）
- 新規作成ボタンが正しく表示されることを確認
- ボタンクリックで `/expenses/new` へ遷移することを確認
- エラー時、ローディング時でもボタンが表示されることを確認

## ファイル変更計画

### 修正対象ファイル
1. **`/frontend/src/app/(authenticated)/(engineer)/expenses/page.tsx`**
   - インポート文の追加（3行）
   - useRouterフックの追加（1行）
   - PageHeaderコンポーネントの修正（3箇所）

### 新規作成ファイル
なし

### 削除ファイル
なし

## テスト戦略

### 1. 手動テスト（必須）
- **環境**: Docker開発環境
- **テスト項目**:
  - 新規作成ボタンの表示確認
  - ボタンクリックによる画面遷移確認
  - エラー状態での表示確認
  - ローディング状態での表示確認
  - レスポンシブデザインの確認

### 2. E2Eテスト（将来的に追加）
- Cypress等を使用した自動テスト
- 新規作成フローの完全な動作確認

### 3. ユニットテスト
- 不要（UI変更のみのため）

## リスク分析と対策

### 識別されたリスク

1. **ActionButtonコンポーネントの不在**
   - **可能性**: 低
   - **影響**: 中
   - **対策**: 実装前にコンポーネントの存在を確認

2. **ルーティングエラー**
   - **可能性**: 低
   - **影響**: 高
   - **対策**: 新規作成画面の存在を事前確認

3. **スタイルの不整合**
   - **可能性**: 低
   - **影響**: 低
   - **対策**: 他画面との一貫性を確認

### リスク緩和策
- 段階的な実装と確認
- 開発環境での十分な動作確認
- コードレビューの実施

## 実装スケジュール

### 見積もり時間
- **合計**: 30分〜1時間

### タスク別時間配分
1. コンポーネント確認と準備: 5分
2. コード実装: 15分
3. 動作確認とテスト: 10分
4. 調整と最終確認: 10分

## 成功基準

1. **機能要件**
   - 経費申請一覧画面に新規作成ボタンが表示される
   - ボタンクリックで新規作成画面へ遷移する
   - すべての状態（通常、エラー、ローディング）でボタンが表示される

2. **非機能要件**
   - プロジェクトのUI/UX標準に準拠している
   - レスポンシブデザインに対応している
   - 既存機能への影響がない

## 実装後の確認事項

1. **コード品質**
   - ESLintエラーがないこと
   - TypeScriptの型エラーがないこと
   - コーディング規約に準拠していること

2. **動作確認**
   - すべてのブラウザで正常に動作すること
   - モバイル表示でも適切に表示されること
   - パフォーマンスへの影響がないこと

## 今後の拡張可能性

1. **権限制御**
   - ユーザーの権限に応じたボタンの表示/非表示

2. **一括操作**
   - 複数選択による一括削除機能
   - エクスポート機能

3. **フィルター機能の強化**
   - 詳細な検索条件の追加
   - 保存可能なフィルターセット

## 参考資料

- 調査結果: `docs/investigate/investigate_20250724_232945.md`
- ActionButtonコンポーネント仕様: `docs/02_frontend/components/ui/action-button.md`
- PageHeaderコンポーネント仕様: 内部実装を参照
- 週報画面の実装例: `/frontend/src/app/(authenticated)/(engineer)/weekly-report/page.tsx`

## 結論

本実装は技術的に容易であり、ユーザビリティの大幅な改善が見込まれる。既存のコンポーネントとパターンを活用することで、低リスクかつ短時間での実装が可能である。