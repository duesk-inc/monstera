# プロフィール画面 経費申請履歴機能削除 実装計画書

## 策定日時
2025年1月15日

## 1. 概要

### 1.1 目的と期待効果
- **目的**: プロフィール画面から経費申請履歴機能を完全に削除し、UIをシンプル化する
- **期待効果**:
  - プロフィール画面のフォーカスを本来の目的（個人情報管理）に集中
  - UIの簡素化によるユーザビリティ向上
  - コードベースの保守性向上（不要な依存関係の削除）

### 1.2 スコープ
- **対象範囲**: プロフィール画面の経費申請履歴タブとその関連コンポーネント
- **対象外**: 
  - 経費申請機能本体（`/expenses`画面）
  - 共有フック・API（`useExpenseSummary`, `expenseSummary.ts`）
  - バックエンドAPI

## 2. 現状と改善後の比較

### 2.1 Before/After 構造

#### 現在の構造（Before）
```
プロフィール画面
├── 基本情報タブ
├── 資格・認定タブ
├── 自己PRタブ
└── 経費申請履歴タブ ← 削除対象
    └── ExpenseProfileSection
        ├── 年次・月次集計表示
        ├── 使用率グラフ
        └── 詳細画面へのリンク
```

#### 改善後の構造（After）
```
プロフィール画面
├── 基本情報タブ
├── 資格・認定タブ
└── 自己PRタブ
```

### 2.2 メトリクスの改善予測
| メトリクス | 現在 | 改善後 | 改善率 |
|-----------|------|--------|--------|
| タブ数 | 4 | 3 | -25% |
| コンポーネント数 | 2 | 1 | -50% |
| import文 | 18 | 16 | -11% |
| コード行数 | 約170行 | 約120行 | -29% |
| バンドルサイズ | - | 約10KB削減 | - |

## 3. 実装計画

### 3.1 Phase 1: コード削除と修正（15分）

#### タスク
1. **ProfileTabbedContent.tsx の修正**
   ```typescript
   // 削除対象:
   - line 8: import { AccountBalanceWallet as WalletIcon } from '@mui/icons-material';
   - line 16: import ExpenseProfileSection from '@/components/profile/ExpenseProfileSection';
   - line 79-87: 経費申請履歴タブ定義
   - line 144-149: 経費申請履歴タブパネル
   ```

2. **ExpenseProfileSection.tsx の削除**
   ```bash
   rm frontend/src/components/profile/ExpenseProfileSection.tsx
   ```

#### 成果物
- 修正済み `ProfileTabbedContent.tsx`
- 削除完了 `ExpenseProfileSection.tsx`

#### チェックポイント
- [ ] import文が正しく削除されている
- [ ] タブ配列から経費申請履歴が削除されている
- [ ] タブパネルから経費申請履歴が削除されている
- [ ] ファイルが物理的に削除されている

### 3.2 Phase 2: ビルドとテスト（10分）

#### タスク
1. **TypeScript型チェック**
   ```bash
   cd frontend
   npx tsc --noEmit
   ```

2. **ビルドテスト**
   ```bash
   npm run build
   ```

3. **開発サーバー起動と動作確認**
   ```bash
   npm run dev
   # http://localhost:3000/profile にアクセス
   ```

#### 成果物
- ビルド成功の確認
- エラーフリーの型チェック結果

#### チェックポイント
- [ ] TypeScriptコンパイルエラーなし
- [ ] ビルドエラーなし
- [ ] 開発サーバーが正常起動
- [ ] プロフィール画面が正常表示
- [ ] 3つのタブが正常に動作
- [ ] コンソールエラーなし

### 3.3 Phase 3: クリーンアップと最適化（5分）

#### タスク
1. **未使用importの検出と削除**
   ```bash
   npm run lint
   ```

2. **コード整形**
   ```bash
   npm run format
   ```

3. **最終確認テスト**
   - タブ切り替えの動作確認
   - 各タブの内容表示確認
   - レスポンシブデザインの確認

#### 成果物
- クリーンなコードベース
- 最適化されたimport文

#### チェックポイント
- [ ] Lintエラーなし
- [ ] フォーマット完了
- [ ] 全機能の動作確認完了

## 4. テスト戦略

### 4.1 自動テスト
1. **ユニットテスト**（既存テストの実行）
   ```bash
   npm test -- ProfileTabbedContent
   ```

2. **統合テスト**
   ```bash
   npm test -- profile
   ```

### 4.2 手動テスト
| テスト項目 | 期待結果 | 優先度 |
|-----------|---------|--------|
| プロフィール画面表示 | エラーなく表示される | 高 |
| タブ切り替え | 3つのタブが正常に切り替わる | 高 |
| 基本情報タブ | 内容が正常に表示・編集可能 | 高 |
| 資格・認定タブ | 内容が正常に表示・編集可能 | 高 |
| 自己PRタブ | 内容が正常に表示・編集可能 | 高 |
| レスポンシブ表示 | モバイル/デスクトップで正常表示 | 中 |
| パフォーマンス | 削除前と同等以上の速度 | 低 |

### 4.3 回帰テスト
- 他の経費関連画面（`/expenses`）が正常動作すること
- プロフィール画面の保存・更新機能が正常動作すること

## 5. リスク管理

### 5.1 技術的リスク

| リスク | 可能性 | 影響度 | 緩和策 |
|--------|--------|--------|--------|
| 参照エラー | 低 | 中 | TypeScript型チェックで事前検出 |
| タブインデックスのズレ | 低 | 低 | 各タブの動作確認で検出 |
| 未使用importの残存 | 中 | 最小 | Lintで自動検出・削除 |
| キャッシュによる表示不具合 | 低 | 最小 | ブラウザキャッシュクリア |

### 5.2 ビジネスリスク

| リスク | 可能性 | 影響度 | 緩和策 |
|--------|--------|--------|--------|
| ユーザーの混乱 | 低 | 低 | 経費画面への導線を明確化 |
| 機能アクセス性低下 | 低 | 低 | メニューから経費画面へ直接アクセス可能 |

## 6. ロールバック計画

### 6.1 即時ロールバック手順
```bash
# Gitで変更を元に戻す
git checkout -- frontend/src/components/features/profile/ProfileTabbedContent.tsx
git checkout -- frontend/src/components/profile/ExpenseProfileSection.tsx

# または特定のコミットにリセット
git reset --hard <削除前のコミットハッシュ>
```

### 6.2 部分的ロールバック
- ProfileTabbedContent.tsx の変更のみを戻す
- ExpenseProfileSection.tsx を復元する

### 6.3 ロールバック判断基準
- プロフィール画面が表示されない
- 他のタブが正常動作しない
- ビルドエラーが解決できない

## 7. タイムライン

| フェーズ | 作業内容 | 所要時間 | 累計時間 |
|---------|----------|----------|----------|
| Phase 1 | コード削除と修正 | 15分 | 15分 |
| Phase 2 | ビルドとテスト | 10分 | 25分 |
| Phase 3 | クリーンアップ | 5分 | 30分 |
| **合計** | | **30分** | |

## 8. 実装後の確認事項

### 8.1 必須確認項目
- [ ] プロフィール画面が正常に表示される
- [ ] 3つのタブが正常に機能する
- [ ] ビルドが成功する
- [ ] TypeScriptエラーがない
- [ ] Lintエラーがない
- [ ] コンソールエラーがない

### 8.2 推奨確認項目
- [ ] バンドルサイズが削減されている
- [ ] ページロード速度が改善または維持されている
- [ ] 他の経費機能が影響を受けていない

## 9. ドキュメント更新

### 9.1 更新対象ドキュメント
- プロフィール画面の操作マニュアル（存在する場合）
- システム設計書のUI構成図（存在する場合）

### 9.2 更新不要なドキュメント
- API仕様書（バックエンドは変更なし）
- データベース設計書（データ構造は変更なし）

## 10. 成功基準

### 10.1 技術的成功基準
- ✅ エラーフリーのビルド
- ✅ 全自動テストがパス
- ✅ 手動テストの全項目がパス
- ✅ パフォーマンス劣化なし

### 10.2 ビジネス的成功基準
- ✅ プロフィール画面のシンプル化達成
- ✅ コードベースの保守性向上
- ✅ ユーザビリティの維持または向上

## ステータス
**status**: SUCCESS  
**next**: REFACTOR-IMPLEMENT  
**details**: "経費申請履歴機能削除の実装計画策定完了。影響範囲は限定的、リスクは最小、実装時間30分以内。refactor-plan_20250115_remove_expense_history.mdに詳細記録。実装フェーズへ移行。"