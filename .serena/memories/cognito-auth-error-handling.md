# Cognito認証エラーハンドリングのベストプラクティス

## 概要
Cognito認証でエラーが発生した際の適切なエラーメッセージ処理パターン

## 重要な原則

### 1. セキュリティファースト
- 存在しないユーザーとパスワード間違いで同じエラーメッセージを返す
- ユーザー列挙攻撃を防ぐため、詳細な情報は返さない

### 2. ユーザーフレンドリー
- 汎用的な「認証に失敗しました」ではなく、具体的で分かりやすいメッセージを使用
- 例：「メールアドレスまたはパスワードが正しくありません」

### 3. 実装パターン

```go
// 良い例
if err != nil {
    s.logger.Error("Cognito認証エラー", zap.Error(err))
    return nil, fmt.Errorf("メールアドレスまたはパスワードが正しくありません")
}

// 避けるべき例
if err != nil {
    return nil, fmt.Errorf("認証に失敗しました") // 汎用的すぎる
}
```

### 4. エラー種別の考慮
将来的にはCognitoのエラータイプを判別して、より適切なメッセージを返すことも検討：
- UserNotFoundException → 「メールアドレスまたはパスワードが正しくありません」
- NotAuthorizedException → 「メールアドレスまたはパスワードが正しくありません」
- UserNotConfirmedException → 「アカウントが確認されていません」
- PasswordResetRequiredException → 「パスワードのリセットが必要です」

### 5. テストの重要性
- エラーメッセージの一貫性をテストで確認
- セキュリティ観点でのテストケースを必ず含める