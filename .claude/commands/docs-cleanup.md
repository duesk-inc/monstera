# DOCS-CLEANUP フェーズ

# ユーザの入力
#$ARGUMENTS

## 目的
重複・冗長・廃止されたドキュメントを特定し、安全に削除またはアーカイブする。ドキュメントの品質と保守性を向上させる。

## 注意事項
- **Model: Opus** - 削除判断は影響が大きいため、必ず**ultrathink**で深く検討すること
- 削除前に必ずバックアップを作成すること
- 歴史的価値のあるドキュメントは削除せずアーカイブすること
- 他のドキュメントからの参照を完全に確認すること

## 必要な入力
- 対象ディレクトリ（デフォルト: docs/）
- 削除基準（重複度、最終更新日、参照なし等）
- アーカイブポリシー

## Serena活用ポイント
```bash
# 1. 参照の確認
search_for_pattern("削除候補ファイル名")  # 他のドキュメントからの参照
search_for_pattern("リンク|link.*削除候補")

# 2. コード内参照の確認
search_for_pattern("docs/.*削除候補")  # コード内のドキュメント参照
search_for_pattern("README|CONTRIBUTING|文書名")

# 3. 重複内容の検出
search_for_pattern("特徴的なフレーズ")  # 複数ファイルでの出現確認
```

## タスクに含まれるべきTODO
1. ユーザの指示を理解し、クリーンアップ開始をコンソールで通知
2. **ultrathinkで削除戦略を深く検討**
3. **削除候補の特定**
   - 完全重複ファイルの検出
   - 部分重複の多いファイル
   - 長期間更新されていないファイル
   - 参照されていないファイル
   - 廃止された機能のドキュメント
4. **影響分析**
   - 内部参照の確認
   - 外部参照の確認（README等）
   - コード内参照の確認
   - 依存関係の分析
5. **分類と優先度付け**
   - **即削除可能**: 完全重複、参照なし
   - **統合候補**: 部分重複が多い
   - **アーカイブ候補**: 歴史的価値あり
   - **保留**: 判断が難しい
6. **バックアップ作成**
   - 削除対象のバックアップ
   - タイムスタンプ付きアーカイブ
7. **削除/アーカイブ実行**
   - 段階的な削除
   - 参照の更新
   - リダイレクト設定（必要な場合）
8. **統合作業**（必要な場合）
   - 重複内容の統合
   - 参照の一本化
   - 構造の簡素化
9. **事後確認**
   - リンク切れチェック
   - ビルドエラーチェック
   - ドキュメント生成確認
10. クリーンアップ結果を `docs/cleanup/docs-cleanup_{TIMESTAMP}.md` に記録
11. アーカイブを `docs/archive/{TIMESTAMP}/` に保存
12. `afplay /System/Library/Sounds/Sosumi.aiff` で完了通知
13. 削除数、統合数、影響をコンソール出力

## 削除基準チェックリスト
- [ ] 完全な重複である
- [ ] 6ヶ月以上更新されていない
- [ ] どこからも参照されていない
- [ ] 廃止された機能に関する内容
- [ ] 他のドキュメントで十分カバーされている
- [ ] 誤った/古い情報を含んでいる
- [ ] プロジェクトの現状と無関係

## アーカイブ基準
- [ ] 歴史的価値がある
- [ ] 将来参照する可能性がある
- [ ] 大規模な変更の記録
- [ ] 重要な意思決定の経緯

## 安全確認コマンド
```bash
# 参照チェック
grep -r "削除候補ファイル名" docs/ --exclude-dir=archive

# リンクチェック
find docs -name "*.md" -exec grep -l "削除候補" {} \;

# ビルド確認（ドキュメント生成がある場合）
make docs-build
```

## 出力ファイル
- `docs/cleanup/docs-cleanup_{TIMESTAMP}.md`
- `docs/archive/{TIMESTAMP}/` - アーカイブディレクトリ

## 最終出力形式
### クリーンアップ完了の場合
status: SUCCESS
next: DOCS-ORGANIZE
details: "クリーンアップ完了。docs-cleanup_{TIMESTAMP}.mdに詳細記録。X件削除、Y件アーカイブ。"

### 統合作業が必要な場合
status: NEEDS_MERGE
next: DOCS-UPDATE
details: "削除完了、統合作業必要。docs-cleanup_{TIMESTAMP}.mdに詳細記録。Z件の統合対象。"

### リスクが高い場合
status: HIGH_RISK
next: USER_INPUT
details: "重要な参照あり。docs-cleanup_{TIMESTAMP}.mdに詳細記録。ユーザー確認必要。"