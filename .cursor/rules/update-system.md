# ドキュメント自動更新システムのルール

このドキュメントはCLAUDE.mdから分離された、ドキュメント自動更新システムの詳細なルールを記載します。

## 更新履歴
- 2025-01-09: 初版作成（CLAUDE.mdから分離）

## システム概要

開発中に得られた知識を体系的に管理し、既存ドキュメントに反映させるシステムです。Claude Codeが作業中に重要な知見を発見した際、ユーザーの承認を得てドキュメントを更新します。

## 更新トリガー

### 自動提案のタイミング

1. **エラー解決時**
   - 新しいエラーパターンを発見・解決した時
   - 既存のトラブルシューティングガイドにない問題を解決した時

2. **効率的な実装パターン発見時**
   - より良いコード実装方法を見つけた時
   - パフォーマンス改善手法を発見した時
   - 再利用可能なパターンを確立した時

3. **新しいAPI/ライブラリ使用時**
   - プロジェクトに新しい依存関係を追加した時
   - 既存ライブラリの新しい使用方法を確立した時
   - 外部APIとの連携方法を実装した時

4. **ドキュメント不整合発見時**
   - 既存ドキュメントの情報が古い/不正確だと判明した時
   - 実装と仕様書の乖離を発見した時

5. **頻出情報の発見時**
   - 同じ情報を複数回参照する必要があった時
   - チーム内で共有すべき重要な情報を発見した時

6. **コードレビュー完了時**
   - レビューで指摘された改善点を反映した時
   - ベストプラクティスが更新された時

## 提案フォーマット

### 標準フォーマット
```
💡 ドキュメント更新の提案： [状況の説明]

【更新内容】
[具体的な追加/修正内容]

【更新候補】
1. [ファイルパス1] - [理由]
2. [ファイルパス2] - [理由]
3. 新規ファイル作成 - [理由]

どこに追加しますか？（番号を選択 or skip）
```

### 提案例
```
💡 ドキュメント更新の提案： 週報一覧でN+1問題を解決しました

【更新内容】
GORMのPreloadを使用してN+1問題を解決する方法：
- Preloadメソッドで関連データを事前読み込み
- 具体的なコード例とパフォーマンス改善結果

【更新候補】
1. .cursor/rules/patterns.md - 実装パターンとして記録
2. .cursor/rules/troubleshooting.md - パフォーマンス問題の解決策として記録
3. docs/01_backend/implementation/repository-implementation.md - リポジトリ実装ガイドに追加

どこに追加しますか？（番号を選択 or skip）
```

## 承認プロセス

### 1. 提案フェーズ
- Claude Codeが更新内容と更新先候補を提示
- ユーザーが更新先を選択（複数選択可）

### 2. プレビューフェーズ
- 選択されたファイルごとに具体的な更新内容をプレビュー表示
- 既存内容との整合性を確認

### 3. 承認フェーズ
```
以下の内容で[ファイルパス]を更新します：

[更新内容のプレビュー]

この内容で更新してよろしいですか？ (yes/edit/no)
```

### 4. 実行フェーズ
- 承認された内容でファイルを更新
- 更新履歴に日付を記録

## 更新ルール

### 基本原則

1. **追記のみ**
   - 既存の内容を削除・変更しない
   - 新しい情報は適切なセクションに追加

2. **形式の踏襲**
   - 既存ファイルの記載形式やスタイルを維持
   - マークダウンの見出しレベルを統一

3. **日付の記録**
   - 更新履歴セクションがある場合は必ず更新
   - YYYY-MM-DD形式で記載

4. **相互参照**
   - 関連する既存内容がある場合は参照を明記
   - 他のドキュメントとの関連性を記載

### 記載内容の基準

#### 含めるべき情報
- 問題の具体的な症状
- 解決方法の詳細な手順
- 実際のコード例
- 動作確認済みの環境情報
- パフォーマンスやセキュリティへの影響

#### 含めない情報
- 機密情報（APIキー、パスワード、個人情報）
- 一時的な回避策（恒久対策がある場合）
- 特定の環境にのみ依存する情報
- 未検証の推測や仮説

## ファイル別の更新ガイドライン

### patterns.md
- 実装パターンは具体的なコード例を必須とする
- Before/Afterの形式で改善点を明確にする
- 使用する場面と条件を明記する

### troubleshooting.md
- 問題、症状、原因、解決策の構造で記載
- エラーメッセージは正確に記録
- 複数の解決策がある場合は優先順位を明記

### dependencies.md
- バージョン情報を含める
- 基本的な使用例を提供
- 公式ドキュメントへのリンクを含める

### remote-integration.md
- 実際に使用したコマンドを記載
- チーム固有のルールがある場合は明記
- セキュリティに関する注意事項を含める

## 参照すべきドキュメント

作業開始時に必ず以下のドキュメントを確認してください：

### プロジェクト概要・規約
- `README.md` - プロジェクト概要とセットアップ手順
- `docs/00_project_overview/README.md` - プロジェクト全体の概要
- `docs/00_project_overview/naming-rules.md` - 命名規則
- `docs/06_standards/error-code-standards.md` - エラーコード標準

### バックエンド実装
- `docs/01_backend/specification.md` - バックエンド仕様書
- `docs/01_backend/implementation/handler-implementation.md` - ハンドラー実装ガイド
- `docs/01_backend/implementation/service-implementation.md` - サービス実装ガイド
- `docs/01_backend/implementation/repository-implementation.md` - リポジトリ実装ガイド
- `docs/01_backend/testing/testing-guide.md` - テストガイド

### フロントエンド実装
- `docs/02_frontend/specification.md` - フロントエンド仕様書
- `docs/02_frontend/component-consolidation-analysis.md` - コンポーネント統合分析
- `docs/UI_Design_Guidelines.md` - UI設計ガイドライン

### データベース
- `docs/03_database/ddl-specification.md` - DDL仕様書
- `docs/postgresql-migration/` - PostgreSQL移行ガイド

### 開発環境・ツール
- `docs/04_development/dev-environment-guide.md` - 開発環境ガイド
- `docs/04_development/debug-logging.md` - デバッグとロギング
- `docs/04_development/redis-cache.md` - Redisキャッシュ設定

### 機能別設計書
- `docs/05_design/weekly-report-basic-design.md` - 週報基本設計
- `docs/05_features/expense-application-basic-design.md` - 経費申請基本設計
- `docs/05_features/leave_management/basic_design.md` - 休暇管理基本設計
- `docs/07_engineer_management/basic_design.md` - エンジニア管理基本設計

## 特殊なケース

### 新規ファイル作成が必要な場合
1. 既存ファイルのいずれにも適さない内容
2. 特定テーマの情報が100行を超える見込み
3. 独立した参照価値がある内容

### 複数ファイルへの更新が必要な場合
1. 異なる観点から同じ情報を記録する必要がある
2. 相互参照が必要な関連情報

### 更新を見送るべき場合
1. 一時的な問題や回避策
2. 特定のユーザー環境にのみ関連する情報
3. セキュリティリスクがある情報

## メンテナンス

### 定期レビュー項目
- 古くなった情報の更新
- 重複情報の統合
- カテゴリの再編成
- 相互参照の更新

### ドキュメントの分割基準
- 1ファイル500行を目安
- 論理的に独立したテーマごと
- 参照頻度に基づく分離

---

*このドキュメントはドキュメント更新システムの運用改善に伴い更新されます。*